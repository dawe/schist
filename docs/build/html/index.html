
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Welcome to schist’s documentation! &#8212; schist 2020 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API" href="api.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="welcome-to-schist-s-documentation">
<h1>Welcome to schist’s documentation!<a class="headerlink" href="#welcome-to-schist-s-documentation" title="Permalink to this headline">¶</a></h1>
<section id="inference">
<h2>Inference<a class="headerlink" href="#inference" title="Permalink to this headline">¶</a></h2>
<section id="module-inference._nested_model">
<span id="nested-model"></span><h3>nested_model<a class="headerlink" href="#module-inference._nested_model" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="inference._nested_model.nested_model">
<span class="sig-prename descclassname"><span class="pre">inference._nested_model.</span></span><span class="sig-name descname"><span class="pre">nested_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">anndata._core.anndata.AnnData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deg_corr</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tolerance</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">1e-06</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_sweep</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">inf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">samples</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collect_marginals</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_jobs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restrict_to</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key_added</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'nsbm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adjacency</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">scipy.sparse.base.spmatrix</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">neighbors_key</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'neighbors'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">directed</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_weights</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_model</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dispatch_backend</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'processes'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">anndata._core.anndata.AnnData</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#inference._nested_model.nested_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Cluster cells into subgroups <span id="id1">[Peixoto14]</span>.</p>
<p>Cluster cells using the nested Stochastic Block Model <span id="id2">[Peixoto14]</span>,
a hierarchical version of Stochastic Block Model <span id="id3">[Holland83]</span>, performing
Bayesian inference on node groups. NSBM should circumvent classical
limitations of SBM in detecting small groups in large graphs
replacing the noninformative priors used by a hierarchy of priors
and hyperpriors.</p>
<p>This requires having ran <code class="xref py py-func docutils literal notranslate"><span class="pre">neighbors()</span></code> or
<code class="xref py py-func docutils literal notranslate"><span class="pre">bbknn()</span></code> first.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> – The annotated data matrix.</p></li>
<li><p><strong>deg_corr</strong> – Whether to use degree correction in the minimization step. In many
real world networks this is the case, although this doesn’t seem
the case for KNN graphs used in scanpy.</p></li>
<li><p><strong>tolerance</strong> – Tolerance for fast model convergence.</p></li>
<li><p><strong>n_sweep</strong> – Number of iterations to be performed in the fast model MCMC greedy approach</p></li>
<li><p><strong>beta</strong> – Inverse temperature for MCMC greedy approach</p></li>
<li><p><strong>samples</strong> – Number of initial minimizations to be performed. The one with smaller
entropy is chosen</p></li>
<li><p><strong>n_jobs</strong> – Number of parallel computations used during model initialization</p></li>
<li><p><strong>key_added</strong> – <cite>adata.obs</cite> key under which to add the cluster labels.</p></li>
<li><p><strong>adjacency</strong> – Sparse adjacency matrix of the graph, defaults to
<cite>adata.uns[‘neighbors’][‘connectivities’]</cite> in case of scanpy&lt;=1.4.6 or
<cite>adata.obsp[neighbors_key][connectivity_key]</cite> for scanpy&gt;1.4.6</p></li>
<li><p><strong>neighbors_key</strong> – The key passed to <cite>sc.pp.neighbors</cite></p></li>
<li><p><strong>directed</strong> – Whether to treat the graph as directed or undirected.</p></li>
<li><p><strong>use_weights</strong> – If <cite>True</cite>, edge weights from the graph are used in the computation
(placing more emphasis on stronger edges). Note that this
increases computation times</p></li>
<li><p><strong>save_model</strong> – If provided, this will be the filename for the PartitionModeState to
be saved</p></li>
<li><p><strong>copy</strong> – Whether to copy <cite>adata</cite> or modify it inplace.</p></li>
<li><p><strong>random_seed</strong> – Random number to be used as seed for graph-tool</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><cite>adata.obs[key_added]</cite> – Array of dim (number of samples) that stores the subgroup id
(<cite>‘0’</cite>, <cite>‘1’</cite>, …) for each cell.</p></li>
<li><p><cite>adata.uns[‘schist’][‘params’]</cite> – A dict with the values for the parameters <cite>resolution</cite>, <cite>random_state</cite>,
and <cite>n_iterations</cite>.</p></li>
<li><p><cite>adata.uns[‘schist’][‘stats’]</cite> – A dict with the values returned by mcmc_sweep</p></li>
<li><p><cite>adata.obsm[‘CA_nsbm_level_{n}’]</cite> – A <cite>np.ndarray</cite> with cell probability of belonging to a specific group</p></li>
<li><p><cite>adata.uns[‘schist’][‘state’]</cite> – The NestedBlockModel state object</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-inference._multi_nested">
<span id="multi-nested"></span><h3>multi_nested<a class="headerlink" href="#module-inference._multi_nested" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="inference._multi_nested.nested_model_multi">
<span class="sig-prename descclassname"><span class="pre">inference._multi_nested.</span></span><span class="sig-name descname"><span class="pre">nested_model_multi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adatas</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">anndata._core.anndata.AnnData</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deg_corr</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tolerance</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">1e-06</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_sweep</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">inf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">samples</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collect_marginals</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_jobs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key_added</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'multi_nsbm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adjacency</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">scipy.sparse.base.spmatrix</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">neighbors_key</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">['neighbors']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">directed</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_weights</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_model</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dispatch_backend</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'processes'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">anndata._core.anndata.AnnData</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#inference._multi_nested.nested_model_multi" title="Permalink to this definition">¶</a></dt>
<dd><p>Cluster cells into subgroups using multiple modalities.</p>
<p>Cluster cells using the nested Stochastic Block Model <span id="id4">[Peixoto14]</span>,
performing Bayesian inference on node groups. This function takes multiple
experiments, possibly across different modalities, and perform joint
clustering.</p>
<p>This requires having ran <code class="xref py py-func docutils literal notranslate"><span class="pre">neighbors()</span></code> or
<code class="xref py py-func docutils literal notranslate"><span class="pre">bbknn()</span></code> first. It also requires cells having the same
names if coming from paired experiments</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adatas</strong> – A list of processed AnnData. Neighbors must have been already
calculated.</p></li>
<li><p><strong>deg_corr</strong> – Whether to use degree correction in the minimization step. In many
real world networks this is the case, although this doesn’t seem
the case for KNN graphs used in scanpy.</p></li>
<li><p><strong>tolerance</strong> – Tolerance for fast model convergence.</p></li>
<li><p><strong>n_sweep</strong> – Number of iterations to be performed in the fast model MCMC greedy approach</p></li>
<li><p><strong>beta</strong> – Inverse temperature for MCMC greedy approach</p></li>
<li><p><strong>samples</strong> – Number of initial minimizations to be performed. The one with smaller
entropy is chosen</p></li>
<li><p><strong>n_jobs</strong> – Number of parallel computations used during model initialization</p></li>
<li><p><strong>key_added</strong> – <cite>adata.obs</cite> key under which to add the cluster labels.</p></li>
<li><p><strong>adjacency</strong> – Sparse adjacency matrix of the graph, defaults to
<cite>adata.uns[‘neighbors’][‘connectivities’]</cite> in case of scanpy&lt;=1.4.6 or
<cite>adata.obsp[neighbors_key][connectivity_key]</cite> for scanpy&gt;1.4.6</p></li>
<li><p><strong>neighbors_key</strong> – The key passed to <cite>sc.pp.neighbors</cite>. If all AnnData share the same key, one
only has to be specified, otherwise the full tuple of all keys must
be provided</p></li>
<li><p><strong>directed</strong> – Whether to treat the graph as directed or undirected.</p></li>
<li><p><strong>use_weights</strong> – If <cite>True</cite>, edge weights from the graph are used in the computation
(placing more emphasis on stronger edges). Note that this
increases computation times</p></li>
<li><p><strong>save_model</strong> – If provided, this will be the filename for the PartitionModeState to
be saved</p></li>
<li><p><strong>copy</strong> – Whether to copy <cite>adata</cite> or modify it inplace.</p></li>
<li><p><strong>random_seed</strong> – Random number to be used as seed for graph-tool</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><cite>adata.obs[key_added]</cite> – Array of dim (number of samples) that stores the subgroup id
(<cite>‘0’</cite>, <cite>‘1’</cite>, …) for each cell.</p></li>
<li><p><cite>adata.uns[‘schist’][‘multi_level_params’]</cite> – A dict with the values for the parameters <cite>resolution</cite>, <cite>random_state</cite>,
and <cite>n_iterations</cite>.</p></li>
<li><p><cite>adata.uns[‘schist’][‘multi_level_stats’]</cite> – A dict with the values returned by mcmc_sweep</p></li>
<li><p><cite>adata.obsm[‘CA_multi_nsbm_level_{n}’]</cite> – A <cite>np.ndarray</cite> with cell probability of belonging to a specific group</p></li>
<li><p><cite>adata.uns[‘schist’][‘multi_level_state’]</cite> – The NestedBlockModel state object</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-inference._planted_model">
<span id="planted-model"></span><h3>planted_model<a class="headerlink" href="#module-inference._planted_model" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="inference._planted_model.planted_model">
<span class="sig-prename descclassname"><span class="pre">inference._planted_model.</span></span><span class="sig-name descname"><span class="pre">planted_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">anndata._core.anndata.AnnData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_sweep</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">inf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tolerance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-06</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collect_marginals</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deg_corr</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">samples</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_jobs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restrict_to</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key_added</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'ppbm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adjacency</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">scipy.sparse.base.spmatrix</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">neighbors_key</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'neighbors'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">directed</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_weights</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_model</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dispatch_backend</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'processes'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">anndata._core.anndata.AnnData</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#inference._planted_model.planted_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Cluster cells into subgroups <span id="id5">[Peixoto14]</span>.</p>
<p>Cluster cells using the  Planted Partition Block Model <span id="id6">[Peixoto14]</span>, performing
Bayesian inference on node groups. This function, in particular, uses
the Planted Block Model, which is particularly suitable in case of
assortative graphs and it returns the optimal number of communities</p>
<p>This requires having ran <code class="xref py py-func docutils literal notranslate"><span class="pre">neighbors()</span></code> or
<code class="xref py py-func docutils literal notranslate"><span class="pre">bbknn()</span></code> first.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> – The annotated data matrix.</p></li>
<li><p><strong>n_sweep</strong> – Number of MCMC sweeps to get the initial guess</p></li>
<li><p><strong>beta</strong> – Inverse temperature for the initial MCMC sweep</p></li>
<li><p><strong>tolerance</strong> – Difference in description length to stop MCMC sweep iterations</p></li>
<li><p><strong>collect_marginals</strong> – Whether or not collect node probability of belonging
to a specific partition.</p></li>
<li><p><strong>deg_corr</strong> – Whether to use degree correction in the minimization step. In many
real world networks this is the case, although this doesn’t seem
the case for KNN graphs used in scanpy.</p></li>
<li><p><strong>samples</strong> – Number of initial minimizations to be performed. This influences also the
precision for marginals</p></li>
<li><p><strong>key_added</strong> – <cite>adata.obs</cite> key under which to add the cluster labels.</p></li>
<li><p><strong>adjacency</strong> – Sparse adjacency matrix of the graph, defaults to
<cite>adata.uns[‘neighbors’][‘connectivities’]</cite> in case of scanpy&lt;=1.4.6 or
<cite>adata.obsp[neighbors_key][connectivity_key]</cite> for scanpy&gt;1.4.6</p></li>
<li><p><strong>neighbors_key</strong> – The key passed to <cite>sc.pp.neighbors</cite></p></li>
<li><p><strong>directed</strong> – Whether to treat the graph as directed or undirected.</p></li>
<li><p><strong>use_weights</strong> – If <cite>True</cite>, edge weights from the graph are used in the computation
(placing more emphasis on stronger edges). Note that this
increases computation times</p></li>
<li><p><strong>copy</strong> – Whether to copy <cite>adata</cite> or modify it inplace.</p></li>
<li><p><strong>save_model</strong> – If provided, this will be the filename for the PartitionModeState to
be saved</p></li>
<li><p><strong>random_seed</strong> – Random number to be used as seed for graph-tool</p></li>
<li><p><strong>n_jobs</strong> – Number of parallel computations used during model initialization</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><cite>adata.obs[key_added]</cite> – Array of dim (number of samples) that stores the subgroup id
(<cite>‘0’</cite>, <cite>‘1’</cite>, …) for each cell.</p></li>
<li><p><cite>adata.uns[‘schist’][‘params’]</cite> – A dict with the values for the parameters <cite>resolution</cite>, <cite>random_state</cite>,
and <cite>n_iterations</cite>.</p></li>
<li><p><cite>adata.uns[‘schist’][‘stats’]</cite> – A dict with the values returned by mcmc_sweep</p></li>
<li><p><cite>adata.obsm[‘CM_ppbm’]</cite> – A <cite>np.ndarray</cite> with cell probability of belonging to a specific group</p></li>
<li><p><cite>adata.uns[‘schist’][‘state’]</cite> – The BlockModel state object</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-inference._flat_model">
<span id="flat-model"></span><h3>flat_model<a class="headerlink" href="#module-inference._flat_model" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="inference._flat_model.flat_model">
<span class="sig-prename descclassname"><span class="pre">inference._flat_model.</span></span><span class="sig-name descname"><span class="pre">flat_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">anndata._core.anndata.AnnData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_sweep</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">inf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tolerance</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">1e-06</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collect_marginals</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deg_corr</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">samples</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_jobs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restrict_to</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key_added</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'sbm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adjacency</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">scipy.sparse.base.spmatrix</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">neighbors_key</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'neighbors'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">directed</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_weights</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">anndata._core.anndata.AnnData</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#inference._flat_model.flat_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Cluster cells into subgroups <span id="id7">[Peixoto14]</span>.</p>
<p>Cluster cells using the  Stochastic Block Model <span id="id8">[Peixoto14]</span>, performing
Bayesian inference on node groups.</p>
<p>This requires having ran <code class="xref py py-func docutils literal notranslate"><span class="pre">neighbors()</span></code> or
<code class="xref py py-func docutils literal notranslate"><span class="pre">bbknn()</span></code> first.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> – The annotated data matrix.</p></li>
<li><p><strong>n_sweep</strong> – Number of MCMC sweeps to get the initial guess</p></li>
<li><p><strong>beta</strong> – Inverse temperature for the initial MCMC sweep</p></li>
<li><p><strong>tolerance</strong> – Difference in description length to stop MCMC sweep iterations</p></li>
<li><p><strong>collect_marginals</strong> – Whether or not collect node probability of belonging
to a specific partition.</p></li>
<li><p><strong>deg_corr</strong> – Whether to use degree correction in the minimization step. In many
real world networks this is the case, although this doesn’t seem
the case for KNN graphs used in scanpy.</p></li>
<li><p><strong>samples</strong> – Number of initial minimizations to be performed. This influences also the
precision for marginals</p></li>
<li><p><strong>key_added</strong> – <cite>adata.obs</cite> key under which to add the cluster labels.</p></li>
<li><p><strong>adjacency</strong> – Sparse adjacency matrix of the graph, defaults to
<cite>adata.uns[‘neighbors’][‘connectivities’]</cite> in case of scanpy&lt;=1.4.6 or
<cite>adata.obsp[neighbors_key][connectivity_key]</cite> for scanpy&gt;1.4.6</p></li>
<li><p><strong>neighbors_key</strong> – The key passed to <cite>sc.pp.neighbors</cite></p></li>
<li><p><strong>directed</strong> – Whether to treat the graph as directed or undirected.</p></li>
<li><p><strong>use_weights</strong> – If <cite>True</cite>, edge weights from the graph are used in the computation
(placing more emphasis on stronger edges). Note that this
increases computation times</p></li>
<li><p><strong>copy</strong> – Whether to copy <cite>adata</cite> or modify it inplace.</p></li>
<li><p><strong>random_seed</strong> – Random number to be used as seed for graph-tool</p></li>
<li><p><strong>n_jobs</strong> – Number of parallel computations used during model initialization</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><cite>adata.obs[key_added]</cite> – Array of dim (number of samples) that stores the subgroup id
(<cite>‘0’</cite>, <cite>‘1’</cite>, …) for each cell.</p></li>
<li><p><cite>adata.uns[‘schist’][‘params’]</cite> – A dict with the values for the parameters <cite>resolution</cite>, <cite>random_state</cite>,
and <cite>n_iterations</cite>.</p></li>
<li><p><cite>adata.uns[‘schist’][‘stats’]</cite> – A dict with the values returned by mcmc_sweep</p></li>
<li><p><cite>adata.obsm[‘CM_sbm’]</cite> – A <cite>np.ndarray</cite> with cell probability of belonging to a specific group</p></li>
<li><p><cite>adata.uns[‘schist’][‘state’]</cite> – The BlockModel state object</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-inference._pmleiden">
<span id="pm-leiden"></span><h3>pm_leiden<a class="headerlink" href="#module-inference._pmleiden" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="inference._pmleiden.leiden">
<span class="sig-prename descclassname"><span class="pre">inference._pmleiden.</span></span><span class="sig-name descname"><span class="pre">leiden</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">anndata._core.anndata.AnnData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resolution</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">samples</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restrict_to</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">numpy.random.mtrand.RandomState</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key_added</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'leiden'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adjacency</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">scipy.sparse.base.spmatrix</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">directed</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_weights</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_iterations</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_type</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><span class="pre">leidenalg.VertexPartition.MutableVertexPartition</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">neighbors_key</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obsp</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collect_marginals</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_jobs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_model</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dispatch_backend</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'processes'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">partition_kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">anndata._core.anndata.AnnData</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#inference._pmleiden.leiden" title="Permalink to this definition">¶</a></dt>
<dd><p>Cluster cells into subgroups <span id="id9">[Traag18]</span>.</p>
<p>Cluster cells using the Leiden algorithm <span id="id10">[Traag18]</span>,
an improved version of the Louvain algorithm <span id="id11">[Blondel08]</span>.
It has been proposed for single-cell analysis by <span id="id12">[Levine15]</span>.</p>
<p>This requires having ran <code class="xref py py-func docutils literal notranslate"><span class="pre">neighbors()</span></code> or
<code class="xref py py-func docutils literal notranslate"><span class="pre">bbknn()</span></code> first.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> – The annotated data matrix.</p></li>
<li><p><strong>resolution</strong> – A parameter value controlling the coarseness of the clustering.
Higher values lead to more clusters.
Set to <cite>None</cite> if overriding <cite>partition_type</cite>
to one that doesn’t accept a <cite>resolution_parameter</cite>.
samples</p></li>
<li><p><strong>samples</strong> – The number of random samples to take for consensus</p></li>
<li><p><strong>random_state</strong> – Change the initialization of the optimization.</p></li>
<li><p><strong>restrict_to</strong> – Restrict the clustering to the categories within the key for sample
annotation, tuple needs to contain <cite>(obs_key, list_of_categories)</cite>.</p></li>
<li><p><strong>key_added</strong> – <cite>adata.obs</cite> key under which to add the cluster labels.</p></li>
<li><p><strong>adjacency</strong> – Sparse adjacency matrix of the graph, defaults to neighbors connectivities.</p></li>
<li><p><strong>directed</strong> – Whether to treat the graph as directed or undirected.</p></li>
<li><p><strong>use_weights</strong> – If <cite>True</cite>, edge weights from the graph are used in the computation
(placing more emphasis on stronger edges).</p></li>
<li><p><strong>n_iterations</strong> – How many iterations of the Leiden clustering algorithm to perform.
Positive values above 2 define the total number of iterations to perform,
-1 has the algorithm run until it reaches its optimal clustering.</p></li>
<li><p><strong>partition_type</strong> – Type of partition to use.
Defaults to <code class="xref py py-class docutils literal notranslate"><span class="pre">RBConfigurationVertexPartition</span></code>.
For the available options, consult the documentation for
<code class="xref py py-func docutils literal notranslate"><span class="pre">find_partition()</span></code>.</p></li>
<li><p><strong>neighbors_key</strong> – Use neighbors connectivities as adjacency.
If not specified, leiden looks .obsp[‘connectivities’] for connectivities
(default storage place for pp.neighbors).
If specified, leiden looks
.obsp[.uns[neighbors_key][‘connectivities_key’]] for connectivities.</p></li>
<li><p><strong>obsp</strong> – Use .obsp[obsp] as adjacency. You can’t specify both
<cite>obsp</cite> and <cite>neighbors_key</cite> at the same time.</p></li>
<li><p><strong>collect_marginals</strong> – Wheter to retrieve the marginal probability to belong to a group</p></li>
<li><p><strong>n_jobs</strong> – Number of parallel jobs to calculate partitions</p></li>
<li><p><strong>copy</strong> – Whether to copy <cite>adata</cite> or modify it inplace.</p></li>
<li><p><strong>save_model</strong> – If provided, this will be the filename for the PartitionModeState to
be saved</p></li>
<li><p><strong>**partition_kwargs</strong> – Any further arguments to pass to <cite>~leidenalg.find_partition</cite>
(which in turn passes arguments to the <cite>partition_type</cite>).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><cite>adata.obs[key_added]</cite> – Array of dim (number of samples) that stores the subgroup id
(<cite>‘0’</cite>, <cite>‘1’</cite>, …) for each cell.</p></li>
<li><p><cite>adata.uns[‘leiden’][‘params’]</cite> – A dict with the values for the parameters <cite>resolution</cite>, <cite>random_state</cite>,
and <cite>n_iterations</cite>.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="plotting">
<h2>Plotting<a class="headerlink" href="#plotting" title="Permalink to this headline">¶</a></h2>
<section id="module-plotting._alluvial">
<span id="alluvial"></span><h3>alluvial<a class="headerlink" href="#module-plotting._alluvial" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="plotting._alluvial.alluvial">
<span class="sig-prename descclassname"><span class="pre">plotting._alluvial.</span></span><span class="sig-name descname"><span class="pre">alluvial</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">anndata._core.anndata.AnnData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level_start</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level_end</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'nsbm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gap</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">legend_fontsize</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="pre">'xx-small'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'x-small'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'small'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'medium'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'large'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'x-large'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'xx-large'</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">legend_fontweight</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="pre">'light'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'normal'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'medium'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'semibold'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'bold'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'heavy'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'black'</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'bold'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis_fontsize</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="pre">'xx-small'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'x-small'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'small'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'medium'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'large'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'x-large'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'xx-large'</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis_fontweight</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="pre">'light'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'normal'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'medium'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'semibold'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'bold'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'heavy'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'black'</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'bold'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#plotting._alluvial.alluvial" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate an alluvial plot for NSBM hierarchy</p>
<p>This plot may be useful to study the hierarchical relations in a Nested
Model generated by <cite>scnbsm.inference.nested_model</cite>.    Note that the <cite>level_end</cite></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> – The annotated data matrix.</p></li>
<li><p><strong>level_start</strong> – The deepest level in the hierarchy (i.e. the one with more clusters)
Note that this parameter marks the leafs of the tree</p></li>
<li><p><strong>level_end</strong> – The coarser level in hierarchy. Default value is <cite>None</cite>, if pruning has not
been performed, it may be useful to exclude uninformative levels anyway
Note that this parameter marks the root of the tree</p></li>
<li><p><strong>key</strong> – The key used to group cells. Default is <cite>nsbm</cite></p></li>
<li><p><strong>gap</strong> – The gap between groups in percentage</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-plotting._draw_tree">
<span id="draw-tree"></span><h3>draw_tree<a class="headerlink" href="#module-plotting._draw_tree" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="plotting._draw_tree.draw_tree">
<span class="sig-prename descclassname"><span class="pre">plotting._draw_tree.</span></span><span class="sig-name descname"><span class="pre">draw_tree</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">anndata._core.anndata.AnnData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">color</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">color_map</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">matplotlib.colors.Colormap</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'nsbm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">matplotlib.axes._axes.Axes</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_backend</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#plotting._draw_tree.draw_tree" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots NSBM hierarchy using graph-tool capabilities</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> – The annotated data matrix.</p></li>
<li><p><strong>level</strong> – The NSBM level to be plot.</p></li>
<li><p><strong>color</strong> – The <cite>adata.obs</cite> property used to generate color. It is mutually exclusive
with <cite>level</cite> option.</p></li>
<li><p><strong>color_map</strong> – Th colormap to use for continuous colors</p></li>
<li><p><strong>save</strong> – Name of the output file. If a non interactive notebook is detected,
this parameter is automatically set.</p></li>
<li><p><strong>key</strong> – The key used to perform nsbm</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="tools">
<h2>Tools<a class="headerlink" href="#tools" title="Permalink to this headline">¶</a></h2>
<section id="module-tools._affinity_tools">
<span id="affinity-tools"></span><h3>affinity_tools<a class="headerlink" href="#module-tools._affinity_tools" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="tools._affinity_tools.calculate_affinity">
<span class="sig-prename descclassname"><span class="pre">tools._affinity_tools.</span></span><span class="sig-name descname"><span class="pre">calculate_affinity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">anndata._core.anndata.AnnData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_key</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'nsbm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group_by</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">neighbors_key</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'neighbors'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adjacency</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">scipy.sparse.base.spmatrix</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">directed</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_weights</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obsp</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">back_prob</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">anndata._core.anndata.AnnData</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#tools._affinity_tools.calculate_affinity" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate cell affinity given a partition scheme. It can be used for
partitions calculated using schist or for any partition scheme, given
for example by cell annotations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> – The AnnData object. Should have been already processed with schist</p></li>
<li><p><strong>level</strong> – The level to calculate affinity. This parameter is effective
only for Nested partitions</p></li>
<li><p><strong>block_key</strong> – The prefix for partitions. This parameter is ignored if the state
is not gt.NestedBlockState</p></li>
<li><p><strong>group_by</strong> – The key for group names used for calculations. Setting this will override
level and block_key. This is effective only for NestedBlockState partitions</p></li>
<li><p><strong>state</strong> – Optionally calculate affinities on this state.</p></li>
<li><p><strong>neighbors_key</strong> – Use neighbors connectivities as adjacency.
If not specified, leiden looks .obsp[‘connectivities’] for connectivities
(default storage place for pp.neighbors).
If specified, leiden looks
.obsp[.uns[neighbors_key][‘connectivities_key’]] for connectivities.</p></li>
<li><p><strong>adjacency</strong> – Sparse adjacency matrix of the graph, defaults to neighbors connectivities.</p></li>
<li><p><strong>directed</strong> – Whether to treat the graph as directed or undirected.</p></li>
<li><p><strong>use_weights</strong> – If <cite>True</cite>, edge weights from the graph are used in the computation
(placing more emphasis on stronger edges).</p></li>
<li><p><strong>copy</strong> – Return a new object or do everything in place</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p>Depending on <cite>copy</cite>, returns or updates <cite>adata</cite> with affinity values</p></li>
<li><p><em>in adata.obsm[f’CA_{block_key}_level_{level}’]</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tools._affinity_tools.cell_similarity">
<span class="sig-prename descclassname"><span class="pre">tools._affinity_tools.</span></span><span class="sig-name descname"><span class="pre">cell_similarity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">anndata._core.anndata.AnnData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key_added</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'cell_similarity'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sim_type</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'hub-promoted'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_weights</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">neighbors_kwds</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">anndata._core.anndata.AnnData</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#tools._affinity_tools.cell_similarity" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate cell similarity score based on the kNN graph. Higher scores
are associated to cells mostly close to similar cells.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> – Annotated data matrix.</p></li>
<li><p><strong>key_added</strong> – The name of the entry in adata.obs with calculated values.</p></li>
<li><p><strong>copy</strong> – Return a copy instead of writing to adata.</p></li>
<li><p><strong>sim_type</strong> – Similarity function. Can be one in ‘dice’, ‘salton’, ‘hub-promoted’,’hub-suppressed’, ‘jaccard’, ‘inv-log-weight’, ‘resource-allocation’,’leight-holme-newman’. For more information check here <a class="reference external" href="https://graph-tool.skewed.de/static/doc/topology.html?highlight=distance#graph_tool.topology.vertex_similarity">https://graph-tool.skewed.de/static/doc/topology.html?highlight=distance#graph_tool.topology.vertex_similarity</a></p></li>
<li><p><strong>state</strong> – A separate block state object</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p>Depending on <cite>copy</cite>, returns or updates <cite>adata</cite> with stability values</p></li>
<li><p><em>in adata.obs[‘cell_stability’]</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tools._affinity_tools.cell_stability">
<span class="sig-prename descclassname"><span class="pre">tools._affinity_tools.</span></span><span class="sig-name descname"><span class="pre">cell_stability</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">anndata._core.anndata.AnnData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_key</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'nsbm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key_added</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'cell_stability'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_marginals</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">neighbors_key</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'neighbors'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adjacency</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">scipy.sparse.base.spmatrix</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">directed</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_weights</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obsp</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">back_prob</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">anndata._core.anndata.AnnData</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#tools._affinity_tools.cell_stability" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate cell stability given cell affinity.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> – Annotated data matrix.</p></li>
<li><p><strong>key</strong> – The prefix of CA matrices in adata.obsm to evaluate.</p></li>
<li><p><strong>copy</strong> – Return a copy instead of writing to adata.</p></li>
<li><p><strong>use_marginals</strong> – Whether to use marginals in place of affinities</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p>Depending on <cite>copy</cite>, returns or updates <cite>adata</cite> with stability values</p></li>
<li><p><em>in adata.obs[‘cell_stability’]</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tools._affinity_tools.cluster_consistency">
<span class="sig-prename descclassname"><span class="pre">tools._affinity_tools.</span></span><span class="sig-name descname"><span class="pre">cluster_consistency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">anndata._core.anndata.AnnData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">groups</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key_added</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'cluster_consistency'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_marginals</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">anndata._core.anndata.AnnData</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#tools._affinity_tools.cluster_consistency" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate cluster consistency at a given level</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> – Annotated data matrix.</p></li>
<li><p><strong>groups</strong> – The key for clusters in adata.obs</p></li>
<li><p><strong>key_added</strong> – The name of obs values that will be added to the adata</p></li>
<li><p><strong>use_marginals</strong> – By default it uses cell affinities for the analysis, but if group marginals
are available from the inference, those can be used here.</p></li>
<li><p><strong>copy</strong> – Return a copy instead of writing to adata.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p>Depending on <cite>copy</cite>, returns or updates <cite>adata</cite> with consistency values</p></li>
<li><p><em>in adata.uns[‘cluster_consistency’] and adata.obs[‘cluster_consistency’]</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<span class="target" id="module-tools._select"></span><dl class="py function">
<dt class="sig sig-object py" id="tools._select.select_affinity">
<span class="sig-prename descclassname"><span class="pre">tools._select.</span></span><span class="sig-name descname"><span class="pre">select_affinity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">anndata._core.anndata.AnnData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'1'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0.9999</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inverse</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'nsbm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_state</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tools._select.select_affinity" title="Permalink to this definition">¶</a></dt>
<dd><p>Selects cells based on the affinity values at a specified level.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> – Annotated data matrix. A NestedBlockState object needs to be saved</p></li>
<li><p><strong>level</strong> – The level to be used for selection</p></li>
<li><p><strong>threshold</strong> – The maximal affinity to be used. Cells with affinities lower than the
threshold will be discarded</p></li>
<li><p><strong>inverse</strong> – Whether to return cells with affinity lower than the threshold</p></li>
<li><p><strong>key</strong> – key of the groupings used to evaluate the model</p></li>
<li><p><strong>update_state</strong> – Whether to update the state removing unselected cells</p></li>
<li><p><strong>filter</strong> – If False, cells are not filtered and only marked in <cite>adata.obs[‘selected’]</cite></p></li>
<li><p><strong>copy</strong> – Whether to perform selection in place or return a subsetted object</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Depending on <cite>copy</cite>, returns or updates <cite>adata</cite> with selected cells.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-tools._draw_graph">
<span id="draw-graph"></span><h3>draw_graph<a class="headerlink" href="#module-tools._draw_graph" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="tools._draw_graph.draw_graph">
<span class="sig-prename descclassname"><span class="pre">tools._draw_graph.</span></span><span class="sig-name descname"><span class="pre">draw_graph</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">anndata._core.anndata.AnnData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layout</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="pre">'fr'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'sfdp'</span><span class="p"><span class="pre">,</span> </span><span class="pre">'arf'</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'sfdp'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_tree</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adjacency</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">scipy.sparse.base.spmatrix</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key_added_ext</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'schist'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tools._draw_graph.draw_graph" title="Permalink to this definition">¶</a></dt>
<dd><p>Extends scanpy.tools.draw_graph function using some layouts available in
graph-tool library. Three layouts are available here:</p>
<ul class="simple">
<li><p>SFDP spring-block layout.</p></li>
<li><p>ARF spring-block layout.</p></li>
<li><p>Fruchterman-Reingold spring-block layout.</p></li>
</ul>
<p>Fruchterman-Reingold is already available in scanpy, but here can be used
to render the nested model tree.</p>
<p>In order to use these plotting function, the NestedBlockState needs to be
saved when building the model, so <cite>save_state=True</cite> needs to be set.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> – Annotated data matrix. A NestedBlockState object needs to be saved</p></li>
<li><p><strong>layout</strong> – A layout among ‘sfdp’, ‘fr’ or ‘arf’. Other graph-tool layouts haven’t been
implemented.</p></li>
<li><p><strong>use_tree</strong> – When this is set, the tree of the nested model is used to generate layout,
otherwise the layout only accounts for the neighborhood graph.</p></li>
<li><p><strong>random_seed</strong> – Random number to be used as seed for graph-tool</p></li>
<li><p><strong>adjacency</strong> – Sparse adjacency matrix of the graph, defaults to
<cite>adata.uns[‘neighbors’][‘connectivities’]</cite>.</p></li>
<li><p><strong>key_added_ext</strong> – By default, append <cite>layout</cite>.</p></li>
<li><p><strong>key</strong> – The slot in <cite>AnnData.uns</cite> containing the state. Default is ‘nsbm’</p></li>
<li><p><strong>copy</strong> – Return a copy instead of writing to adata.</p></li>
<li><p><strong>**kwds</strong> – <p>Parameters of chosen igraph layout. See e.g. <a class="reference external" href="http://igraph.org/python/doc/igraph.Graph-class.html#layout_fruchterman_reingold">fruchterman-reingold</a>
<span id="id13">[Fruchterman91]</span>. One of the most important ones is <cite>maxiter</cite>.</p>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p>Depending on <cite>copy</cite>, returns or updates <cite>adata</cite> with the following field.</p></li>
<li><p><strong>**X_draw_graph_layout**</strong> (<cite>adata.obsm</cite>) – Coordinates of graph layout. E.g. for layout=’fa’ (the default),
the field is called ‘X_draw_graph_fa’</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-tools._tl_utils">
<span id="tl-utils"></span><h3>tl_utils<a class="headerlink" href="#module-tools._tl_utils" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="tools._tl_utils.get_cell_back_p">
<span class="sig-prename descclassname"><span class="pre">tools._tl_utils.</span></span><span class="sig-name descname"><span class="pre">get_cell_back_p</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">graph_tool.inference.nested_blockmodel.NestedBlockState</span><span class="p"><span class="pre">,</span> </span><span class="pre">graph_tool.inference.planted_partition.PPBlockState</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tools._tl_utils.get_cell_back_p" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the matrix of proabilities of moving a cell back to its
group from a different block</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> – A graphtool BlockState or NestedBlockState objexct</p></li>
<li><p><strong>level</strong> – The level in NestedBlockState to consider</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Array of dim (n_cells, n_blocks) that stores the entropy difference
of moving a cell into a specific group</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>M</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tools._tl_utils.get_cell_loglikelihood">
<span class="sig-prename descclassname"><span class="pre">tools._tl_utils.</span></span><span class="sig-name descname"><span class="pre">get_cell_loglikelihood</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">graph_tool.inference.nested_blockmodel.NestedBlockState</span><span class="p"><span class="pre">,</span> </span><span class="pre">graph_tool.inference.planted_partition.PPBlockState</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rescale</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">as_prob</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tools._tl_utils.get_cell_loglikelihood" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the matrix of log-likelihood differences
when moving a cell into a different block</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> – A graphtool BlockState or NestedBlockState objexct</p></li>
<li><p><strong>level</strong> – The level in NestedBlockState to consider</p></li>
<li><p><strong>rescale</strong> – For some models, moving a cell into a different block may result in a
negative log-likelihood, indicating that cells may be better assigned
to another group. Set this parameter to <cite>True</cite> if you want
every cell to have LL=0 for the best group and avoid negative values</p></li>
<li><p><strong>as_prob</strong> – Return values as probabilites</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Array of dim (n_cells, n_blocks) that stores the entropy difference
of moving a cell into a specific group</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>M</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tools._tl_utils.state_from_blocks">
<span class="sig-prename descclassname"><span class="pre">tools._tl_utils.</span></span><span class="sig-name descname"><span class="pre">state_from_blocks</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">anndata._core.anndata.AnnData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state_key</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'nsbm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">neighbors_key</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'neighbors'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adjacency</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">scipy.sparse.base.spmatrix</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">directed</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_weights</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deg_corr</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tools._tl_utils.state_from_blocks" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a gt state object given an AnnData</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> – The annotated data matrix.</p></li>
<li><p><strong>state_key</strong> – The key under which the state has been saved</p></li>
<li><p><strong>neighbors_key</strong> – The key passed to <cite>sc.pp.neighbors</cite></p></li>
<li><p><strong>adjacency</strong> – Sparse adjacency matrix of the graph, defaults to
<cite>adata.uns[‘neighbors’][‘connectivities’]</cite> in case of scanpy&lt;=1.4.6 or
<cite>adata.obsp[neighbors_key][connectivity_key]</cite> for scanpy&gt;1.4.6</p></li>
<li><p><strong>directed</strong> – Whether to treat the graph as directed or undirected.</p></li>
<li><p><strong>use_weights</strong> – If <cite>True</cite>, edge weights from the graph are used in the computation
(placing more emphasis on stronger edges). Note that this
increases computation times</p></li>
<li><p><strong>deg_corr</strong> – Whether to use degree correction in the minimization step. In many
real world networks this is the case, although this doesn’t seem
the case for KNN graphs used in scanpy.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="generated/inference.nested_model.html">inference.nested_model</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/inference.nested_model_multi.html">inference.nested_model_multi</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/inference.planted_model.html">inference.planted_model</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/inference.flat_model.html">inference.flat_model</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/inference.leiden.html">inference.leiden</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/plotting.alluvial.html">plotting.alluvial</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/plotting.draw_tree.html">plotting.draw_tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/tools.cell_similarity.html">tools.cell_similarity</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/tools.cell_stability.html">tools.cell_stability</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/tools.cluster_consistency.html">tools.cluster_consistency</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/tools.calculate_affinity.html">tools.calculate_affinity</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/tools.draw_graph.html">tools.draw_graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/tools.get_cell_back_p.html">tools.get_cell_back_p</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/tools.get_cell_loglikelihood.html">tools.get_cell_loglikelihood</a></li>
</ul>
</li>
</ul>
</div>
</section>
</section>
<section id="indices-and-tables">
<h2>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
<p>schist has its documentation hosted on Read the Docs.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="#">schist</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
      <li>Next: <a href="api.html" title="next chapter">API</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Morelli Leonardo, Giansanti Valentina, Cittaro Davide.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>