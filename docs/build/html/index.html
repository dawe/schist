
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Welcome to schist’s documentation! &#8212; schist 2020 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API" href="api.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="welcome-to-schist-s-documentation">
<h1>Welcome to schist’s documentation!<a class="headerlink" href="#welcome-to-schist-s-documentation" title="Permalink to this headline">¶</a></h1>
<section id="intro">
<h2>INTRO<a class="headerlink" href="#intro" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="garnet.png"><img alt="logo" src="garnet.png" style="width: 200px; height: 200px;" /></a>
</section>
<section id="schist">
<h2>SCHIST<a class="headerlink" href="#schist" title="Permalink to this headline">¶</a></h2>
<p>An interface for Nested Stochastic Block Model for single cell analysis. The idea behind <code class="docutils literal notranslate"><span class="pre">schist</span></code> is to create a <cite>scanpy</cite>-compatible interface to <code class="docutils literal notranslate"><span class="pre">graph-tool</span></code> methods.</p>
<section id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<p>As <code class="docutils literal notranslate"><span class="pre">schist</span></code> is available from conda-forge, installation is just easy as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">schist</span>
</pre></div>
</div>
<p>This will install <code class="docutils literal notranslate"><span class="pre">graph-tool-base</span></code> package as dependency, which does not include complete graphical capabilities. If you need access to the full <code class="docutils literal notranslate"><span class="pre">graph-tool</span></code> infrastracture, install it with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">graph</span><span class="o">-</span><span class="n">tool</span>
</pre></div>
</div>
<p>If you want to install <code class="docutils literal notranslate"><span class="pre">schist</span></code> from source, clone this repository and install in the usual way</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">dawe</span><span class="o">/</span><span class="n">schist</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">schist</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">.</span>
</pre></div>
</div>
</section>
<section id="how-to-use">
<h3>How to use<a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h3>
<p>Once <code class="docutils literal notranslate"><span class="pre">schist</span></code> has been installed, it can be used out of the box on <code class="docutils literal notranslate"><span class="pre">scanpy</span></code> objects:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">schist</span> <span class="k">as</span> <span class="nn">scs</span>
<span class="n">scs</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">nested_model</span><span class="p">(</span><span class="n">adata</span><span class="p">)</span>
</pre></div>
</div>
<p>Once the MCMC has converged, the <code class="docutils literal notranslate"><span class="pre">adata.obs</span></code> object will contain additional columns for multiple levels, named <code class="docutils literal notranslate"><span class="pre">nsbm_level_0</span></code>, <code class="docutils literal notranslate"><span class="pre">nsbm_level_1</span></code>, <code class="docutils literal notranslate"><span class="pre">nsbm_level_2</span></code> and so on.</p>
</section>
<section id="cite">
<h3>Cite<a class="headerlink" href="#cite" title="Permalink to this headline">¶</a></h3>
<p>We are preparing the manuscript. In the meantime, if you use <cite>schist</cite> you may cite the preprint:</p>
<div class="highlight-None notranslate"><div class="highlight"><pre><span></span>@article{morelli_2020,
title = {Nested stochastic block models applied to the analysis of single cell data},
author = {Morelli, Leonardo and Giansanti, Valentina and Cittaro, Davide},
url = {http://biorxiv.org/lookup/doi/10.1101/2020.06.28.176180},
year = {2020},
month = {jun},
day = {29},
urldate = {2020-07-02},
journal = {BioRxiv},
doi = {10.1101/2020.06.28.176180},
}
</pre></div>
</div>
</section>
<section id="name">
<h3>Name<a class="headerlink" href="#name" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">schist</span></code> is a <a class="reference external" href="https://en.wikipedia.org/wiki/Schist">type of rock</a>. Previous name for this project was <code class="docutils literal notranslate"><span class="pre">scNSBM</span></code>, which was hard to pronounce and caused typos when writing (<code class="docutils literal notranslate"><span class="pre">scnbsm</span></code> or <code class="docutils literal notranslate"><span class="pre">scbsnm</span></code> and so on…). We looked for a name which should have “single cell” in it (sc), something about the stochastic model (st) and something about the hierarchy (hi). That’s were <code class="docutils literal notranslate"><span class="pre">schist</span></code> comes from.</p>
<section id="inference">
<h4>Inference<a class="headerlink" href="#inference" title="Permalink to this headline">¶</a></h4>
<section id="module-inference._nested_model">
<span id="nested-model"></span><h5>nested_model<a class="headerlink" href="#module-inference._nested_model" title="Permalink to this headline">¶</a></h5>
<dl class="py function">
<dt class="sig sig-object py" id="inference._nested_model.nested_model">
<span class="sig-prename descclassname"><span class="pre">inference._nested_model.</span></span><span class="sig-name descname"><span class="pre">nested_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">adata:</span> <span class="pre">&lt;Mock</span> <span class="pre">name='mock.AnnData'</span> <span class="pre">id='140041018723088'&gt;</span></em>, <em class="sig-param"><span class="pre">deg_corr:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></em>, <em class="sig-param"><span class="pre">tolerance:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">1e-06</span></em>, <em class="sig-param"><span class="pre">n_sweep:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">10</span></em>, <em class="sig-param"><span class="pre">beta:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">&lt;Mock</span> <span class="pre">name='mock.inf'</span> <span class="pre">id='140041018725392'&gt;</span></em>, <em class="sig-param"><span class="pre">samples:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">100</span></em>, <em class="sig-param"><span class="pre">collect_marginals:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></em>, <em class="sig-param"><span class="pre">n_jobs:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">-1</span></em>, <em class="sig-param"><span class="pre">*</span></em>, <em class="sig-param"><span class="pre">restrict_to:</span> <span class="pre">Optional[Tuple[str</span></em>, <em class="sig-param"><span class="pre">Sequence[str]]]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">random_seed:</span> <span class="pre">Optional[int]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">key_added:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'nsbm'</span></em>, <em class="sig-param"><span class="pre">adjacency:</span> <span class="pre">Optional[&lt;Mock</span> <span class="pre">name='mock.sparse.spmatrix'</span> <span class="pre">id='140041018725904'&gt;]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">neighbors_key:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">'neighbors'</span></em>, <em class="sig-param"><span class="pre">directed:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></em>, <em class="sig-param"><span class="pre">use_weights:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></em>, <em class="sig-param"><span class="pre">save_model:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">copy:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></em>, <em class="sig-param"><span class="pre">dispatch_backend:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">'processes'</span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Optional[&lt;Mock</span> <span class="pre">name=’mock.AnnData’</span> <span class="pre">id=’140041018723088’&gt;]</span></span></span><a class="headerlink" href="#inference._nested_model.nested_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Cluster cells into subgroups <span id="id1">[Peixoto14]</span>.</p>
<p>Cluster cells using the nested Stochastic Block Model <span id="id2">[Peixoto14]</span>,
a hierarchical version of Stochastic Block Model <span id="id3">[Holland83]</span>, performing
Bayesian inference on node groups. NSBM should circumvent classical
limitations of SBM in detecting small groups in large graphs
replacing the noninformative priors used by a hierarchy of priors
and hyperpriors.</p>
<p>This requires having ran <code class="xref py py-func docutils literal notranslate"><span class="pre">neighbors()</span></code> or
<code class="xref py py-func docutils literal notranslate"><span class="pre">bbknn()</span></code> first.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> – The annotated data matrix.</p></li>
<li><p><strong>deg_corr</strong> – Whether to use degree correction in the minimization step. In many
real world networks this is the case, although this doesn’t seem
the case for KNN graphs used in scanpy.</p></li>
<li><p><strong>tolerance</strong> – Tolerance for fast model convergence.</p></li>
<li><p><strong>n_sweep</strong> – Number of iterations to be performed in the fast model MCMC greedy approach</p></li>
<li><p><strong>beta</strong> – Inverse temperature for MCMC greedy approach</p></li>
<li><p><strong>samples</strong> – Number of initial minimizations to be performed. The one with smaller
entropy is chosen</p></li>
<li><p><strong>n_jobs</strong> – Number of parallel computations used during model initialization</p></li>
<li><p><strong>key_added</strong> – <cite>adata.obs</cite> key under which to add the cluster labels.</p></li>
<li><p><strong>adjacency</strong> – Sparse adjacency matrix of the graph, defaults to
<cite>adata.uns[‘neighbors’][‘connectivities’]</cite> in case of scanpy&lt;=1.4.6 or
<cite>adata.obsp[neighbors_key][connectivity_key]</cite> for scanpy&gt;1.4.6</p></li>
<li><p><strong>neighbors_key</strong> – The key passed to <cite>sc.pp.neighbors</cite></p></li>
<li><p><strong>directed</strong> – Whether to treat the graph as directed or undirected.</p></li>
<li><p><strong>use_weights</strong> – If <cite>True</cite>, edge weights from the graph are used in the computation
(placing more emphasis on stronger edges). Note that this
increases computation times</p></li>
<li><p><strong>save_model</strong> – If provided, this will be the filename for the PartitionModeState to
be saved</p></li>
<li><p><strong>copy</strong> – Whether to copy <cite>adata</cite> or modify it inplace.</p></li>
<li><p><strong>random_seed</strong> – Random number to be used as seed for graph-tool</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><cite>adata.obs[key_added]</cite> – Array of dim (number of samples) that stores the subgroup id
(<cite>‘0’</cite>, <cite>‘1’</cite>, …) for each cell.</p></li>
<li><p><cite>adata.uns[‘schist’][‘params’]</cite> – A dict with the values for the parameters <cite>resolution</cite>, <cite>random_state</cite>,
and <cite>n_iterations</cite>.</p></li>
<li><p><cite>adata.uns[‘schist’][‘stats’]</cite> – A dict with the values returned by mcmc_sweep</p></li>
<li><p><cite>adata.obsm[‘CA_nsbm_level_{n}’]</cite> – A <cite>np.ndarray</cite> with cell probability of belonging to a specific group</p></li>
<li><p><cite>adata.uns[‘schist’][‘state’]</cite> – The NestedBlockModel state object</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-inference._multi_nested">
<span id="multi-nested"></span><h5>multi_nested<a class="headerlink" href="#module-inference._multi_nested" title="Permalink to this headline">¶</a></h5>
<dl class="py function">
<dt class="sig sig-object py" id="inference._multi_nested.nested_model_multi">
<span class="sig-prename descclassname"><span class="pre">inference._multi_nested.</span></span><span class="sig-name descname"><span class="pre">nested_model_multi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">adatas:</span> <span class="pre">List[&lt;Mock</span> <span class="pre">name='mock.AnnData'</span> <span class="pre">id='140041018723088'&gt;],</span> <span class="pre">deg_corr:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True,</span> <span class="pre">tolerance:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">1e-06,</span> <span class="pre">n_sweep:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">10,</span> <span class="pre">beta:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">&lt;Mock</span> <span class="pre">name='mock.inf'</span> <span class="pre">id='140041018725392'&gt;,</span> <span class="pre">samples:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">100,</span> <span class="pre">collect_marginals:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True,</span> <span class="pre">n_jobs:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">-1,</span> <span class="pre">*,</span> <span class="pre">random_seed:</span> <span class="pre">Optional[int]</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">key_added:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'multi_nsbm',</span> <span class="pre">adjacency:</span> <span class="pre">Optional[List[&lt;Mock</span> <span class="pre">name='mock.sparse.spmatrix'</span> <span class="pre">id='140041018725904'&gt;]]</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">neighbors_key:</span> <span class="pre">Optional[List[str]]</span> <span class="pre">=</span> <span class="pre">['neighbors'],</span> <span class="pre">directed:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False,</span> <span class="pre">use_weights:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False,</span> <span class="pre">save_model:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">copy:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False,</span> <span class="pre">dispatch_backend:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">'processes'</span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Optional[List[&lt;Mock</span> <span class="pre">name=’mock.AnnData’</span> <span class="pre">id=’140041018723088’&gt;]]</span></span></span><a class="headerlink" href="#inference._multi_nested.nested_model_multi" title="Permalink to this definition">¶</a></dt>
<dd><p>Cluster cells into subgroups using multiple modalities.</p>
<p>Cluster cells using the nested Stochastic Block Model <span id="id4">[Peixoto14]</span>,
performing Bayesian inference on node groups. This function takes multiple
experiments, possibly across different modalities, and perform joint
clustering.</p>
<p>This requires having ran <code class="xref py py-func docutils literal notranslate"><span class="pre">neighbors()</span></code> or
<code class="xref py py-func docutils literal notranslate"><span class="pre">bbknn()</span></code> first. It also requires cells having the same
names if coming from paired experiments</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adatas</strong> – A list of processed AnnData. Neighbors must have been already
calculated.</p></li>
<li><p><strong>deg_corr</strong> – Whether to use degree correction in the minimization step. In many
real world networks this is the case, although this doesn’t seem
the case for KNN graphs used in scanpy.</p></li>
<li><p><strong>tolerance</strong> – Tolerance for fast model convergence.</p></li>
<li><p><strong>n_sweep</strong> – Number of iterations to be performed in the fast model MCMC greedy approach</p></li>
<li><p><strong>beta</strong> – Inverse temperature for MCMC greedy approach</p></li>
<li><p><strong>samples</strong> – Number of initial minimizations to be performed. The one with smaller
entropy is chosen</p></li>
<li><p><strong>n_jobs</strong> – Number of parallel computations used during model initialization</p></li>
<li><p><strong>key_added</strong> – <cite>adata.obs</cite> key under which to add the cluster labels.</p></li>
<li><p><strong>adjacency</strong> – Sparse adjacency matrix of the graph, defaults to
<cite>adata.uns[‘neighbors’][‘connectivities’]</cite> in case of scanpy&lt;=1.4.6 or
<cite>adata.obsp[neighbors_key][connectivity_key]</cite> for scanpy&gt;1.4.6</p></li>
<li><p><strong>neighbors_key</strong> – The key passed to <cite>sc.pp.neighbors</cite>. If all AnnData share the same key, one
only has to be specified, otherwise the full tuple of all keys must
be provided</p></li>
<li><p><strong>directed</strong> – Whether to treat the graph as directed or undirected.</p></li>
<li><p><strong>use_weights</strong> – If <cite>True</cite>, edge weights from the graph are used in the computation
(placing more emphasis on stronger edges). Note that this
increases computation times</p></li>
<li><p><strong>save_model</strong> – If provided, this will be the filename for the PartitionModeState to
be saved</p></li>
<li><p><strong>copy</strong> – Whether to copy <cite>adata</cite> or modify it inplace.</p></li>
<li><p><strong>random_seed</strong> – Random number to be used as seed for graph-tool</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><cite>adata.obs[key_added]</cite> – Array of dim (number of samples) that stores the subgroup id
(<cite>‘0’</cite>, <cite>‘1’</cite>, …) for each cell.</p></li>
<li><p><cite>adata.uns[‘schist’][‘multi_level_params’]</cite> – A dict with the values for the parameters <cite>resolution</cite>, <cite>random_state</cite>,
and <cite>n_iterations</cite>.</p></li>
<li><p><cite>adata.uns[‘schist’][‘multi_level_stats’]</cite> – A dict with the values returned by mcmc_sweep</p></li>
<li><p><cite>adata.obsm[‘CA_multi_nsbm_level_{n}’]</cite> – A <cite>np.ndarray</cite> with cell probability of belonging to a specific group</p></li>
<li><p><cite>adata.uns[‘schist’][‘multi_level_state’]</cite> – The NestedBlockModel state object</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-inference._planted_model">
<span id="planted-model"></span><h5>planted_model<a class="headerlink" href="#module-inference._planted_model" title="Permalink to this headline">¶</a></h5>
<dl class="py function">
<dt class="sig sig-object py" id="inference._planted_model.planted_model">
<span class="sig-prename descclassname"><span class="pre">inference._planted_model.</span></span><span class="sig-name descname"><span class="pre">planted_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">adata:</span> <span class="pre">&lt;Mock</span> <span class="pre">name='mock.AnnData'</span> <span class="pre">id='140041018723088'&gt;</span></em>, <em class="sig-param"><span class="pre">n_sweep:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">10</span></em>, <em class="sig-param"><span class="pre">beta:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">&lt;Mock</span> <span class="pre">name='mock.inf'</span> <span class="pre">id='140041018725392'&gt;</span></em>, <em class="sig-param"><span class="pre">tolerance=1e-06</span></em>, <em class="sig-param"><span class="pre">collect_marginals:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></em>, <em class="sig-param"><span class="pre">deg_corr:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></em>, <em class="sig-param"><span class="pre">samples:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">100</span></em>, <em class="sig-param"><span class="pre">n_jobs:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">-1</span></em>, <em class="sig-param"><span class="pre">*</span></em>, <em class="sig-param"><span class="pre">restrict_to:</span> <span class="pre">Optional[Tuple[str</span></em>, <em class="sig-param"><span class="pre">Sequence[str]]]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">random_seed:</span> <span class="pre">Optional[int]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">key_added:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'ppbm'</span></em>, <em class="sig-param"><span class="pre">adjacency:</span> <span class="pre">Optional[&lt;Mock</span> <span class="pre">name='mock.sparse.spmatrix'</span> <span class="pre">id='140041018725904'&gt;]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">neighbors_key:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">'neighbors'</span></em>, <em class="sig-param"><span class="pre">directed:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></em>, <em class="sig-param"><span class="pre">use_weights:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></em>, <em class="sig-param"><span class="pre">copy:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></em>, <em class="sig-param"><span class="pre">save_model:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">dispatch_backend:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">'processes'</span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Optional[&lt;Mock</span> <span class="pre">name=’mock.AnnData’</span> <span class="pre">id=’140041018723088’&gt;]</span></span></span><a class="headerlink" href="#inference._planted_model.planted_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Cluster cells into subgroups <span id="id5">[Peixoto14]</span>.</p>
<p>Cluster cells using the  Planted Partition Block Model <span id="id6">[Peixoto14]</span>, performing
Bayesian inference on node groups. This function, in particular, uses
the Planted Block Model, which is particularly suitable in case of
assortative graphs and it returns the optimal number of communities</p>
<p>This requires having ran <code class="xref py py-func docutils literal notranslate"><span class="pre">neighbors()</span></code> or
<code class="xref py py-func docutils literal notranslate"><span class="pre">bbknn()</span></code> first.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> – The annotated data matrix.</p></li>
<li><p><strong>n_sweep</strong> – Number of MCMC sweeps to get the initial guess</p></li>
<li><p><strong>beta</strong> – Inverse temperature for the initial MCMC sweep</p></li>
<li><p><strong>tolerance</strong> – Difference in description length to stop MCMC sweep iterations</p></li>
<li><p><strong>collect_marginals</strong> – Whether or not collect node probability of belonging
to a specific partition.</p></li>
<li><p><strong>deg_corr</strong> – Whether to use degree correction in the minimization step. In many
real world networks this is the case, although this doesn’t seem
the case for KNN graphs used in scanpy.</p></li>
<li><p><strong>samples</strong> – Number of initial minimizations to be performed. This influences also the
precision for marginals</p></li>
<li><p><strong>key_added</strong> – <cite>adata.obs</cite> key under which to add the cluster labels.</p></li>
<li><p><strong>adjacency</strong> – Sparse adjacency matrix of the graph, defaults to
<cite>adata.uns[‘neighbors’][‘connectivities’]</cite> in case of scanpy&lt;=1.4.6 or
<cite>adata.obsp[neighbors_key][connectivity_key]</cite> for scanpy&gt;1.4.6</p></li>
<li><p><strong>neighbors_key</strong> – The key passed to <cite>sc.pp.neighbors</cite></p></li>
<li><p><strong>directed</strong> – Whether to treat the graph as directed or undirected.</p></li>
<li><p><strong>use_weights</strong> – If <cite>True</cite>, edge weights from the graph are used in the computation
(placing more emphasis on stronger edges). Note that this
increases computation times</p></li>
<li><p><strong>copy</strong> – Whether to copy <cite>adata</cite> or modify it inplace.</p></li>
<li><p><strong>save_model</strong> – If provided, this will be the filename for the PartitionModeState to
be saved</p></li>
<li><p><strong>random_seed</strong> – Random number to be used as seed for graph-tool</p></li>
<li><p><strong>n_jobs</strong> – Number of parallel computations used during model initialization</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><cite>adata.obs[key_added]</cite> – Array of dim (number of samples) that stores the subgroup id
(<cite>‘0’</cite>, <cite>‘1’</cite>, …) for each cell.</p></li>
<li><p><cite>adata.uns[‘schist’][‘params’]</cite> – A dict with the values for the parameters <cite>resolution</cite>, <cite>random_state</cite>,
and <cite>n_iterations</cite>.</p></li>
<li><p><cite>adata.uns[‘schist’][‘stats’]</cite> – A dict with the values returned by mcmc_sweep</p></li>
<li><p><cite>adata.obsm[‘CM_ppbm’]</cite> – A <cite>np.ndarray</cite> with cell probability of belonging to a specific group</p></li>
<li><p><cite>adata.uns[‘schist’][‘state’]</cite> – The BlockModel state object</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-inference._flat_model">
<span id="flat-model"></span><h5>flat_model<a class="headerlink" href="#module-inference._flat_model" title="Permalink to this headline">¶</a></h5>
<dl class="py function">
<dt class="sig sig-object py" id="inference._flat_model.flat_model">
<span class="sig-prename descclassname"><span class="pre">inference._flat_model.</span></span><span class="sig-name descname"><span class="pre">flat_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">adata:</span> <span class="pre">&lt;Mock</span> <span class="pre">name='mock.AnnData'</span> <span class="pre">id='140041018723088'&gt;</span></em>, <em class="sig-param"><span class="pre">n_sweep:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">10</span></em>, <em class="sig-param"><span class="pre">beta:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">&lt;Mock</span> <span class="pre">name='mock.inf'</span> <span class="pre">id='140041018725392'&gt;</span></em>, <em class="sig-param"><span class="pre">tolerance:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">1e-06</span></em>, <em class="sig-param"><span class="pre">collect_marginals:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></em>, <em class="sig-param"><span class="pre">deg_corr:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></em>, <em class="sig-param"><span class="pre">samples:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">100</span></em>, <em class="sig-param"><span class="pre">n_jobs:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">-1</span></em>, <em class="sig-param"><span class="pre">*</span></em>, <em class="sig-param"><span class="pre">restrict_to:</span> <span class="pre">Optional[Tuple[str</span></em>, <em class="sig-param"><span class="pre">Sequence[str]]]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">random_seed:</span> <span class="pre">Optional[int]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">key_added:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'sbm'</span></em>, <em class="sig-param"><span class="pre">adjacency:</span> <span class="pre">Optional[&lt;Mock</span> <span class="pre">name='mock.sparse.spmatrix'</span> <span class="pre">id='140041018725904'&gt;]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">neighbors_key:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">'neighbors'</span></em>, <em class="sig-param"><span class="pre">directed:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></em>, <em class="sig-param"><span class="pre">use_weights:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></em>, <em class="sig-param"><span class="pre">copy:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Optional[&lt;Mock</span> <span class="pre">name=’mock.AnnData’</span> <span class="pre">id=’140041018723088’&gt;]</span></span></span><a class="headerlink" href="#inference._flat_model.flat_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Cluster cells into subgroups <span id="id7">[Peixoto14]</span>.</p>
<p>Cluster cells using the  Stochastic Block Model <span id="id8">[Peixoto14]</span>, performing
Bayesian inference on node groups.</p>
<p>This requires having ran <code class="xref py py-func docutils literal notranslate"><span class="pre">neighbors()</span></code> or
<code class="xref py py-func docutils literal notranslate"><span class="pre">bbknn()</span></code> first.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> – The annotated data matrix.</p></li>
<li><p><strong>n_sweep</strong> – Number of MCMC sweeps to get the initial guess</p></li>
<li><p><strong>beta</strong> – Inverse temperature for the initial MCMC sweep</p></li>
<li><p><strong>tolerance</strong> – Difference in description length to stop MCMC sweep iterations</p></li>
<li><p><strong>collect_marginals</strong> – Whether or not collect node probability of belonging
to a specific partition.</p></li>
<li><p><strong>deg_corr</strong> – Whether to use degree correction in the minimization step. In many
real world networks this is the case, although this doesn’t seem
the case for KNN graphs used in scanpy.</p></li>
<li><p><strong>samples</strong> – Number of initial minimizations to be performed. This influences also the
precision for marginals</p></li>
<li><p><strong>key_added</strong> – <cite>adata.obs</cite> key under which to add the cluster labels.</p></li>
<li><p><strong>adjacency</strong> – Sparse adjacency matrix of the graph, defaults to
<cite>adata.uns[‘neighbors’][‘connectivities’]</cite> in case of scanpy&lt;=1.4.6 or
<cite>adata.obsp[neighbors_key][connectivity_key]</cite> for scanpy&gt;1.4.6</p></li>
<li><p><strong>neighbors_key</strong> – The key passed to <cite>sc.pp.neighbors</cite></p></li>
<li><p><strong>directed</strong> – Whether to treat the graph as directed or undirected.</p></li>
<li><p><strong>use_weights</strong> – If <cite>True</cite>, edge weights from the graph are used in the computation
(placing more emphasis on stronger edges). Note that this
increases computation times</p></li>
<li><p><strong>copy</strong> – Whether to copy <cite>adata</cite> or modify it inplace.</p></li>
<li><p><strong>random_seed</strong> – Random number to be used as seed for graph-tool</p></li>
<li><p><strong>n_jobs</strong> – Number of parallel computations used during model initialization</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><cite>adata.obs[key_added]</cite> – Array of dim (number of samples) that stores the subgroup id
(<cite>‘0’</cite>, <cite>‘1’</cite>, …) for each cell.</p></li>
<li><p><cite>adata.uns[‘schist’][‘params’]</cite> – A dict with the values for the parameters <cite>resolution</cite>, <cite>random_state</cite>,
and <cite>n_iterations</cite>.</p></li>
<li><p><cite>adata.uns[‘schist’][‘stats’]</cite> – A dict with the values returned by mcmc_sweep</p></li>
<li><p><cite>adata.obsm[‘CM_sbm’]</cite> – A <cite>np.ndarray</cite> with cell probability of belonging to a specific group</p></li>
<li><p><cite>adata.uns[‘schist’][‘state’]</cite> – The BlockModel state object</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-inference._pmleiden">
<span id="pm-leiden"></span><h5>pm_leiden<a class="headerlink" href="#module-inference._pmleiden" title="Permalink to this headline">¶</a></h5>
<dl class="py function">
<dt class="sig sig-object py" id="inference._pmleiden.leiden">
<span class="sig-prename descclassname"><span class="pre">inference._pmleiden.</span></span><span class="sig-name descname"><span class="pre">leiden</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">adata:</span> <span class="pre">&lt;Mock</span> <span class="pre">name='mock.AnnData'</span> <span class="pre">id='140041018723088'&gt;</span></em>, <em class="sig-param"><span class="pre">resolution:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">1</span></em>, <em class="sig-param"><span class="pre">samples:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">100</span></em>, <em class="sig-param"><span class="pre">*</span></em>, <em class="sig-param"><span class="pre">restrict_to:</span> <span class="pre">Optional[Tuple[str</span></em>, <em class="sig-param"><span class="pre">Sequence[str]]]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">random_state:</span> <span class="pre">&lt;Mock</span> <span class="pre">name='mock._utils.AnyRandom'</span> <span class="pre">id='140041019313424'&gt;</span> <span class="pre">=</span> <span class="pre">0</span></em>, <em class="sig-param"><span class="pre">key_added:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'leiden'</span></em>, <em class="sig-param"><span class="pre">adjacency:</span> <span class="pre">Optional[&lt;Mock</span> <span class="pre">name='mock.sparse.spmatrix'</span> <span class="pre">id='140041018725904'&gt;]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">directed:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></em>, <em class="sig-param"><span class="pre">use_weights:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></em>, <em class="sig-param"><span class="pre">n_iterations:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">-1</span></em>, <em class="sig-param"><span class="pre">partition_type:</span> <span class="pre">Optional[Type[leidenalg.VertexPartition.MutableVertexPartition]]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">neighbors_key:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">obsp:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">collect_marginals:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></em>, <em class="sig-param"><span class="pre">n_jobs:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">-1</span></em>, <em class="sig-param"><span class="pre">copy:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></em>, <em class="sig-param"><span class="pre">save_model:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">dispatch_backend:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">'processes'</span></em>, <em class="sig-param"><span class="pre">**partition_kwargs</span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Optional[&lt;Mock</span> <span class="pre">name=’mock.AnnData’</span> <span class="pre">id=’140041018723088’&gt;]</span></span></span><a class="headerlink" href="#inference._pmleiden.leiden" title="Permalink to this definition">¶</a></dt>
<dd><p>Cluster cells into subgroups <span id="id9">[Traag18]</span>.</p>
<p>Cluster cells using the Leiden algorithm <span id="id10">[Traag18]</span>,
an improved version of the Louvain algorithm <span id="id11">[Blondel08]</span>.
It has been proposed for single-cell analysis by <span id="id12">[Levine15]</span>.</p>
<p>This requires having ran <code class="xref py py-func docutils literal notranslate"><span class="pre">neighbors()</span></code> or
<code class="xref py py-func docutils literal notranslate"><span class="pre">bbknn()</span></code> first.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> – The annotated data matrix.</p></li>
<li><p><strong>resolution</strong> – A parameter value controlling the coarseness of the clustering.
Higher values lead to more clusters.
Set to <cite>None</cite> if overriding <cite>partition_type</cite>
to one that doesn’t accept a <cite>resolution_parameter</cite>.
samples</p></li>
<li><p><strong>samples</strong> – The number of random samples to take for consensus</p></li>
<li><p><strong>random_state</strong> – Change the initialization of the optimization.</p></li>
<li><p><strong>restrict_to</strong> – Restrict the clustering to the categories within the key for sample
annotation, tuple needs to contain <cite>(obs_key, list_of_categories)</cite>.</p></li>
<li><p><strong>key_added</strong> – <cite>adata.obs</cite> key under which to add the cluster labels.</p></li>
<li><p><strong>adjacency</strong> – Sparse adjacency matrix of the graph, defaults to neighbors connectivities.</p></li>
<li><p><strong>directed</strong> – Whether to treat the graph as directed or undirected.</p></li>
<li><p><strong>use_weights</strong> – If <cite>True</cite>, edge weights from the graph are used in the computation
(placing more emphasis on stronger edges).</p></li>
<li><p><strong>n_iterations</strong> – How many iterations of the Leiden clustering algorithm to perform.
Positive values above 2 define the total number of iterations to perform,
-1 has the algorithm run until it reaches its optimal clustering.</p></li>
<li><p><strong>partition_type</strong> – Type of partition to use.
Defaults to <code class="xref py py-class docutils literal notranslate"><span class="pre">RBConfigurationVertexPartition</span></code>.
For the available options, consult the documentation for
<code class="xref py py-func docutils literal notranslate"><span class="pre">find_partition()</span></code>.</p></li>
<li><p><strong>neighbors_key</strong> – Use neighbors connectivities as adjacency.
If not specified, leiden looks .obsp[‘connectivities’] for connectivities
(default storage place for pp.neighbors).
If specified, leiden looks
.obsp[.uns[neighbors_key][‘connectivities_key’]] for connectivities.</p></li>
<li><p><strong>obsp</strong> – Use .obsp[obsp] as adjacency. You can’t specify both
<cite>obsp</cite> and <cite>neighbors_key</cite> at the same time.</p></li>
<li><p><strong>collect_marginals</strong> – Wheter to retrieve the marginal probability to belong to a group</p></li>
<li><p><strong>n_jobs</strong> – Number of parallel jobs to calculate partitions</p></li>
<li><p><strong>copy</strong> – Whether to copy <cite>adata</cite> or modify it inplace.</p></li>
<li><p><strong>save_model</strong> – If provided, this will be the filename for the PartitionModeState to
be saved</p></li>
<li><p><strong>**partition_kwargs</strong> – Any further arguments to pass to <cite>~leidenalg.find_partition</cite>
(which in turn passes arguments to the <cite>partition_type</cite>).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><cite>adata.obs[key_added]</cite> – Array of dim (number of samples) that stores the subgroup id
(<cite>‘0’</cite>, <cite>‘1’</cite>, …) for each cell.</p></li>
<li><p><cite>adata.uns[‘leiden’][‘params’]</cite> – A dict with the values for the parameters <cite>resolution</cite>, <cite>random_state</cite>,
and <cite>n_iterations</cite>.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="plotting">
<h4>Plotting<a class="headerlink" href="#plotting" title="Permalink to this headline">¶</a></h4>
<section id="alluvial">
<h5>alluvial<a class="headerlink" href="#alluvial" title="Permalink to this headline">¶</a></h5>
</section>
<section id="draw-tree">
<h5>draw_tree<a class="headerlink" href="#draw-tree" title="Permalink to this headline">¶</a></h5>
</section>
</section>
<section id="tools">
<h4>Tools<a class="headerlink" href="#tools" title="Permalink to this headline">¶</a></h4>
<section id="affinity-tools">
<h5>affinity_tools<a class="headerlink" href="#affinity-tools" title="Permalink to this headline">¶</a></h5>
</section>
<section id="draw-graph">
<h5>draw_graph<a class="headerlink" href="#draw-graph" title="Permalink to this headline">¶</a></h5>
</section>
<section id="tl-utils">
<h5>tl_utils<a class="headerlink" href="#tl-utils" title="Permalink to this headline">¶</a></h5>
<div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="generated/inference.nested_model.html">inference.nested_model</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/inference.nested_model_multi.html">inference.nested_model_multi</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/inference.planted_model.html">inference.planted_model</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/inference.flat_model.html">inference.flat_model</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/inference.leiden.html">inference.leiden</a></li>
</ul>
</li>
</ul>
</div>
</section>
</section>
<section id="indices-and-tables">
<h4>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
<p>schist has its documentation hosted on Read the Docs.</p>
</section>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="#">schist</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
      <li>Next: <a href="api.html" title="next chapter">API</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Morelli Leonardo, Giansanti Valentina, Cittaro Davide.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>